
var typingTimer;var doneTypingInterval=1000;var hostname="http://79605d26.ngrok.com"
var project_id="JshVywO_sL_2Ra2lN5m";var project_name="";var files=[];var currentFile="";var currentData=editor.getValue();loadFiles();

$('#editor').keyup(function(){clearTimeout(typingTimer);typingTimer=setTimeout(doneTyping,doneTypingInterval);});$('#editor').keydown(function(){clearTimeout(typingTimer);});$("#statusTime").text(moment().calendar());function doneTyping(){var code=editor.getValue();if(code!=currentData){currentData=code;for(var k=0;k<files.length;k++){var filedata=files[k];if(filedata.name==currentFile){filedata.data=code;}}
$.ajax({type:'POST',url:hostname+'/update-project-contents',data:{"id":project_id,"files":files},error:function(err){console.log(err);},success:function(data){console.log(data);},dataType:"json"});}}
function loadFiles(){$.ajax({type:'POST',url:hostname+'/get-project-contents',data:{"id":project_id},error:function(err){console.log(err);},success:function(data){console.log(data);data.files.shift();files=data.files;for(var i=0;i<data.files.length;i++){console.log(data.files[i].name);$("#fileMenu").append('<div name="'+data.files[i].name+'" onclick=\"javascript: currentFile = $(this).attr(\'name\'); $(\'#fileMenu div\').css({\'background-color\': \'transparent\', \'font-weight\': \'normal\', \'color\': \'black\'}); $(this).css({\'background-color\': \'rgb(14, 101, 227)\', \'font-weight\':\'bold\', \'color\':\'white\'}); updateEditor();\">'+start_and_end(data.files[i].name)+'</div>');}
editor.setValue(files[0].data);editor.scrollToLine(0);currentFile=files[0].name;$.get(hostname+'/get-project-details/'+project_id,function(data){console.log(data)
project_name=data.project.name;$("#appName").text(project_name);$("#fileMenu").prepend("<div style=\"margin-top: 5px;\"><b><img height=\"20pt\" style=\"vertical-align:middle;margin-top: -5px;\" src=\"img/folder-icon.svg\" />&nbsp;"+data.project.name+"</b></div>")});},dataType:"json"});}
$("#runButton").click(function(){buildProject();});var listener=new window.keypress.Listener();listener.simple_combo("alt r",function(){console.log("used keyboard shortcut to start buildProject()");buildProject();});function buildProject(){$("#statusValue").html('<img src="img/loading.gif" />&nbsp;&nbsp;Building');$("#outputArea").html('<center>Building your application...</center>'); var code=editor.getValue();if(code!=currentData){currentData=code;for(var k=0;k<files.length;k++){var filedata=files[k];if(filedata.name==currentFile){filedata.data=code;}}
$.ajax({type:'POST',url:hostname+'/update-project-contents',data:{"id":project_id,"files":files},error:function(err){console.log(err);console.log("Saving files prior to building..."); $.ajax({type:'POST',url:hostname+'/build-project',data:{"id":project_id},error:function(err){console.log(err);},success:function(data){console.log(data);$("#statusValue").text("Ready");$("#statusTime").text(moment().calendar());$("#outputArea").html("<center>"+data.fullDeviceEmbedCode+"</center>");if(data.BUILD_FAILED){$("#statusValue").text("Failed");$("#outputArea").text(data.BUILD_FAILED);var normalized=($("#outputArea").text()).split("\n").join("<br />");$("#outputArea").html("<span style=\"color:red; font-weight:bold;\">BUILD FAILED</span><br /><div>"+normalized+"</div><br /><br />");}},dataType:"json"});},success:function(data){console.log(data);},dataType:"json"});}}
$("#fileMenu").click(function(){console.log(currentFile);console.log($(this).attr("name"));});function updateEditor(){for(var j=0;j<files.length;j++){if(files[j].name==currentFile){editor.setValue(files[j].data);}}
editor.scrollToLine(0);}
function start_and_end(str){if(str.length>20){return str.substr(0,10)+'...'+str.substr(str.length-7,str.length);}
return str;}